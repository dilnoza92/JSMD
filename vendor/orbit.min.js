THREE.OrbitControls=function(e,t){this.object=e;this.domElement=t!==undefined?t:document;this.enabled=true;this.target=new THREE.Vector3;this.center=this.target;this.noZoom=false;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=false;this.rotateSpeed=1;this.noPan=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.noKeys=false;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var n=this;var a=1e-6;var o=new THREE.Vector2;var i=new THREE.Vector2;var s=new THREE.Vector2;var r=new THREE.Vector2;var c=new THREE.Vector2;var u=new THREE.Vector2;var l=new THREE.Vector3;var d=new THREE.Vector3;var h=new THREE.Vector2;var p=new THREE.Vector2;var f=new THREE.Vector2;var E=0;var m=0;var v=1;var b=new THREE.Vector3;var y=new THREE.Vector3;var T=new THREE.Quaternion;var g={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var O=g.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();var R=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0));var H=R.clone().inverse();var L={type:"change"};var P={type:"start"};var w={type:"end"};this.rotateLeft=function(e){if(e===undefined){e=M()}m-=e};this.rotateUp=function(e){if(e===undefined){e=M()}E-=e};this.panLeft=function(e){var t=this.object.matrix.elements;l.set(t[0],t[1],t[2]);l.multiplyScalar(-e);b.add(l)};this.panUp=function(e){var t=this.object.matrix.elements;l.set(t[4],t[5],t[6]);l.multiplyScalar(e);b.add(l)};this.pan=function(e,t){var a=n.domElement===document?n.domElement.body:n.domElement;if(n.object.fov!==undefined){var o=n.object.position;var i=o.clone().sub(n.target);var s=i.length();s*=Math.tan(n.object.fov/2*Math.PI/180);n.panLeft(2*e*s/a.clientHeight);n.panUp(2*t*s/a.clientHeight)}else if(n.object.top!==undefined){n.panLeft(e*(n.object.right-n.object.left)/a.clientWidth);n.panUp(t*(n.object.top-n.object.bottom)/a.clientHeight)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}};this.dollyIn=function(e){if(e===undefined){e=k()}v/=e};this.dollyOut=function(e){if(e===undefined){e=k()}v*=e};this.update=function(){var e=this.object.position;d.copy(e).sub(this.target);d.applyQuaternion(R);var t=Math.atan2(d.x,d.z);var n=Math.atan2(Math.sqrt(d.x*d.x+d.z*d.z),d.y);if(this.autoRotate){this.rotateLeft(M())}t+=m;n+=E;n=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,n));n=Math.max(a,Math.min(Math.PI-a,n));var o=d.length()*v;o=Math.max(this.minDistance,Math.min(this.maxDistance,o));this.target.add(b);d.x=o*Math.sin(n)*Math.sin(t);d.y=o*Math.cos(n);d.z=o*Math.sin(n)*Math.cos(t);d.applyQuaternion(H);e.copy(this.target).add(d);this.object.lookAt(this.target);m=0;E=0;v=1;b.set(0,0,0);if(y.distanceToSquared(this.object.position)>a||8*(1-T.dot(this.object.quaternion))>a){this.dispatchEvent(L);y.copy(this.object.position);T.copy(this.object.quaternion)}};this.reset=function(){O=g.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};function M(){return 2*Math.PI/60/60*n.autoRotateSpeed}function k(){return Math.pow(.95,n.zoomSpeed)}function N(e){if(n.enabled===false)return;e.preventDefault();if(e.button===0){if(n.noRotate===true)return;O=g.ROTATE;o.set(e.clientX,e.clientY)}else if(e.button===1){if(n.noZoom===true)return;O=g.DOLLY;h.set(e.clientX,e.clientY)}else if(e.button===2){if(n.noPan===true)return;O=g.PAN;r.set(e.clientX,e.clientY)}document.addEventListener("mousemove",V,false);document.addEventListener("mouseup",j,false);n.dispatchEvent(P)}function V(e){if(n.enabled===false)return;e.preventDefault();var t=n.domElement===document?n.domElement.body:n.domElement;if(O===g.ROTATE){if(n.noRotate===true)return;i.set(e.clientX,e.clientY);s.subVectors(i,o);n.rotateLeft(2*Math.PI*s.x/t.clientWidth*n.rotateSpeed);n.rotateUp(2*Math.PI*s.y/t.clientHeight*n.rotateSpeed);o.copy(i)}else if(O===g.DOLLY){if(n.noZoom===true)return;p.set(e.clientX,e.clientY);f.subVectors(p,h);if(f.y>0){n.dollyIn()}else{n.dollyOut()}h.copy(p)}else if(O===g.PAN){if(n.noPan===true)return;c.set(e.clientX,e.clientY);u.subVectors(c,r);n.pan(u.x,u.y);r.copy(c)}n.update()}function j(){if(n.enabled===false)return;document.removeEventListener("mousemove",V,false);document.removeEventListener("mouseup",j,false);n.dispatchEvent(w);O=g.NONE}function Y(e){if(n.enabled===false||n.noZoom===true)return;e.preventDefault();e.stopPropagation();var t=0;if(e.wheelDelta!==undefined){t=e.wheelDelta}else if(e.detail!==undefined){t=-e.detail}if(t>0){n.dollyOut()}else{n.dollyIn()}n.update();n.dispatchEvent(P);n.dispatchEvent(w)}function D(e){if(n.enabled===false||n.noKeys===true||n.noPan===true)return;switch(e.keyCode){case n.keys.UP:n.pan(0,n.keyPanSpeed);n.update();break;case n.keys.BOTTOM:n.pan(0,-n.keyPanSpeed);n.update();break;case n.keys.LEFT:n.pan(n.keyPanSpeed,0);n.update();break;case n.keys.RIGHT:n.pan(-n.keyPanSpeed,0);n.update();break}}function x(e){if(n.enabled===false)return;switch(e.touches.length){case 1:if(n.noRotate===true)return;O=g.TOUCH_ROTATE;o.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(n.noZoom===true)return;O=g.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX;var a=e.touches[0].pageY-e.touches[1].pageY;var i=Math.sqrt(t*t+a*a);h.set(0,i);break;case 3:if(n.noPan===true)return;O=g.TOUCH_PAN;r.set(e.touches[0].pageX,e.touches[0].pageY);break;default:O=g.NONE}n.dispatchEvent(P)}function A(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();var t=n.domElement===document?n.domElement.body:n.domElement;switch(e.touches.length){case 1:if(n.noRotate===true)return;if(O!==g.TOUCH_ROTATE)return;i.set(e.touches[0].pageX,e.touches[0].pageY);s.subVectors(i,o);n.rotateLeft(2*Math.PI*s.x/t.clientWidth*n.rotateSpeed);n.rotateUp(2*Math.PI*s.y/t.clientHeight*n.rotateSpeed);o.copy(i);n.update();break;case 2:if(n.noZoom===true)return;if(O!==g.TOUCH_DOLLY)return;var a=e.touches[0].pageX-e.touches[1].pageX;var l=e.touches[0].pageY-e.touches[1].pageY;var d=Math.sqrt(a*a+l*l);p.set(0,d);f.subVectors(p,h);if(f.y>0){n.dollyOut()}else{n.dollyIn()}h.copy(p);n.update();break;case 3:if(n.noPan===true)return;if(O!==g.TOUCH_PAN)return;c.set(e.touches[0].pageX,e.touches[0].pageY);u.subVectors(c,r);n.pan(u.x,u.y);r.copy(c);n.update();break;default:O=g.NONE}}function S(){if(n.enabled===false)return;n.dispatchEvent(w);O=g.NONE}this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousedown",N,false);this.domElement.addEventListener("mousewheel",Y,false);this.domElement.addEventListener("DOMMouseScroll",Y,false);this.domElement.addEventListener("touchstart",x,false);this.domElement.addEventListener("touchend",S,false);this.domElement.addEventListener("touchmove",A,false);window.addEventListener("keydown",D,false);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);